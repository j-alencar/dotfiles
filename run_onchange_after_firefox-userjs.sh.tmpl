#!/bin/bash
# hash: {{ include "dot_config/firefox/user.js" | sha256sum }}

set -euo pipefail

USERJS="{{ .chezmoi.sourceDir }}/dot_config/firefox/user.js"

{{ if eq .chezmoi.os "linux" }}
PROFILE_DIR=$(find "$HOME/.mozilla/firefox" -maxdepth 1 -name "*.default-release" -type d 2>/dev/null | head -1)
if [[ -z "$PROFILE_DIR" ]]; then
    PROFILE_DIR=$(find "$HOME/.mozilla/firefox" -maxdepth 1 -name "*.default" -type d 2>/dev/null | head -1)
fi
{{ else if eq .chezmoi.os "windows" }}
PROFILE_DIR=$(find "$APPDATA/Mozilla/Firefox/Profiles" -maxdepth 1 -name "*.default-release" -type d 2>/dev/null | head -1)
if [[ -z "$PROFILE_DIR" ]]; then
    PROFILE_DIR=$(find "$APPDATA/Mozilla/Firefox/Profiles" -maxdepth 1 -name "*.default" -type d 2>/dev/null | head -1)
fi
{{ end }}

if [[ -z "${PROFILE_DIR:-}" ]]; then
    echo "No Firefox profile found â€” skipping user.js deployment."
    exit 0
fi

cp "$HOME/.config/firefox/user.js" "$PROFILE_DIR/user.js"
echo "Deployed user.js to $PROFILE_DIR"
